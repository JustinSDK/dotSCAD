include <unittest.scad>;
include <circle_path.scad>;
include <rotate_p.scad>;
include <golden_spiral.scad>;

module test_golden_spiral() {
    echo("==== test_golden_spiral ====");

    pts_angles = golden_spiral(
        from = 3, 
        to = 10, 
        point_distance = 1
    );
    
    expected_pts = [[2, 0], [1.8478, 0.7654], [1.4142, 1.4142], [0.7654, 1.8478], [0, 2], [-0.9271, 1.8532], [-1.7634, 1.4271], [-2.4271, 0.7634], [-2.8532, -0.0729], [-3, -1], [-2.9039, -1.9755], [-2.6194, -2.9134], [-2.1573, -3.7779], [-1.5355, -4.5355], [-0.7779, -5.1573], [0.0866, -5.6194], [1.0245, -5.9039], [2, -6], [2.9643, -5.9417], [3.9145, -5.7675], [4.8368, -5.4801], [5.7178, -5.0836], [6.5445, -4.5839], [7.305, -3.9881], [7.9881, -3.305], [8.5839, -2.5445], [9.0836, -1.7178], [9.4801, -0.8368], [9.7675, 0.0855], [9.9417, 1.0357], [10, 2], [10, 2], [9.9636, 2.9715], [9.8548, 3.9375], [9.6741, 4.8928], [9.4224, 5.8318], [9.1014, 6.7494], [8.7126, 7.6405], [8.2583, 8.5], [7.7411, 9.3232], [7.1638, 10.1054], [6.5297, 10.8422], [5.8422, 11.5297], [5.1054, 12.1638], [4.3232, 12.7411], [3.5, 13.2583], [2.6405, 13.7126], [1.7494, 14.1014], [0.8318, 14.4224], [-0.1072, 14.6741], [-1.0625, 14.8548], [-2.0285, 14.9636], [-3, 15], [-3.9992, 14.9762], [-4.9962, 14.9049], [-5.9886, 14.7863], [-6.9743, 14.6205], [-7.9509, 14.408], [-8.9164, 14.1494], [-9.8684, 13.845], [-10.8049, 13.4957], [-11.7237, 13.1023], [-12.6228, 12.6655], [-13.5, 12.1865], [-14.3535, 11.6663], [-15.1812, 11.1061], [-15.9813, 10.5071], [-16.7521, 9.8707], [-17.4917, 9.1984], [-18.1984, 8.4917], [-18.8707, 7.7521], [-19.5071, 6.9813], [-20.1061, 6.1812], [-20.6663, 5.3535], [-21.1865, 4.5], [-21.6655, 3.6228], [-22.1023, 2.7237], [-22.4957, 1.8049], [-22.845, 0.8684], [-23.1494, -0.0836], [-23.408, -1.0491], [-23.6205, -2.0257], [-23.7863, -3.0114], [-23.9049, -4.0038], [-23.9762, -5.0008], [-24, -6], [-23.9856, -6.9889], [-23.9425, -7.9769], [-23.8706, -8.9633], [-23.7701, -9.9472], [-23.641, -10.9277], [-23.4835, -11.904], [-23.2976, -12.8754], [-23.0835, -13.8409], [-22.8415, -14.7998], [-22.5716, -15.7513], [-22.2742, -16.6945], [-21.9495, -17.6287], [-21.5978, -18.553], [-21.2193, -19.4667], [-20.8145, -20.369], [-20.3835, -21.2592], [-19.9268, -22.1364], [-19.4449, -23], [-18.938, -23.8492], [-18.4066, -24.6833], [-17.8512, -25.5016], [-17.2722, -26.3034], [-16.6701, -27.088], [-16.0455, -27.8548], [-15.3989, -28.6031], [-14.7307, -29.3322], [-14.0416, -30.0416], [-13.3322, -30.7307], [-12.6031, -31.3989], [-11.8548, -32.0455], [-11.088, -32.6701], [-10.3034, -33.2722], [-9.5016, -33.8512], [-8.6833, -34.4066], [-7.8492, -34.938], [-7, -35.4449], [-6.1364, -35.9268], [-5.2592, -36.3835], [-4.369, -36.8145], [-3.4667, -37.2193], [-2.553, -37.5978], [-1.6287, -37.9495], [-0.6945, -38.2742], [0.2487, -38.5716], [1.2002, -38.8415], [2.1591, -39.0835], [3.1246, -39.2976], [4.096, -39.4835], [5.0723, -39.641], [6.0528, -39.7701], [7.0367, -39.8706], [8.0231, -39.9425], [9.0111, -39.9856], [10, -40], [10.993, -39.991], [11.9856, -39.9641], [12.9776, -39.9193], [13.9687, -39.8566], [14.9584, -39.776], [15.9465, -39.6776], [16.9327, -39.5613], [17.9167, -39.4273], [18.898, -39.2755], [19.8765, -39.106], [20.8517, -38.9188], [21.8234, -38.7141], [22.7912, -38.4919], [23.7549, -38.2523], [24.7141, -37.9952], [25.6684, -37.721], [26.6177, -37.4295], [27.5616, -37.1209], [28.4997, -36.7954], [29.4318, -36.4529], [30.3576, -36.0937], [31.2767, -35.7179], [32.1889, -35.3255], [33.0939, -34.9166], [33.9913, -34.4916], [34.881, -34.0504], [35.7625, -33.5932], [36.6356, -33.1201], [37.5, -32.6314], [38.3555, -32.1271], [39.2017, -31.6075], [40.0384, -31.0727], [40.8653, -30.5229], [41.6821, -29.9582], [42.4887, -29.3789], [43.2846, -28.7851], [44.0697, -28.1771], [44.8436, -27.5549], [45.6062, -26.9189], [46.3573, -26.2692], [47.0964, -25.6061], [47.8235, -24.9298], [48.5382, -24.2404], [49.2404, -23.5382], [49.9298, -22.8235], [50.6061, -22.0964], [51.2692, -21.3573], [51.9189, -20.6062], [52.5549, -19.8436], [53.1771, -19.0697], [53.7851, -18.2846], [54.3789, -17.4887], [54.9582, -16.6821], [55.5229, -15.8653], [56.0727, -15.0384], [56.6075, -14.2017], [57.1271, -13.3555], [57.6314, -12.5], [58.1201, -11.6356], [58.5932, -10.7625], [59.0504, -9.881], [59.4916, -8.9913], [59.9166, -8.0939], [60.3255, -7.1889], [60.7179, -6.2767], [61.0937, -5.3576], [61.4529, -4.4318], [61.7954, -3.4997], [62.1209, -2.5616], [62.4295, -1.6177], [62.721, -0.6684], [62.9952, 0.2859], [63.2523, 1.2451], [63.4919, 2.2088], [63.7141, 3.1766], [63.9188, 4.1483], [64.106, 5.1235], [64.2755, 6.102], [64.4273, 7.0833], [64.5613, 8.0673], [64.6776, 9.0535], [64.776, 10.0416], [64.8566, 11.0313], [64.9193, 12.0224], [64.9641, 13.0144], [64.991, 14.007], [65, 15]];
    
    actual_pts = [for(pt_angle = pts_angles) pt_angle[0]];   

    expected_angles =  [0, 22.5, 45, 67.5, 90, 108, 126, 144, 162, 180, 191.25, 202.5, 213.75, 225, 236.25, 247.5, 258.75, 270, 276.923, 283.846, 290.769, 297.692, 304.615, 311.538, 318.462, 325.385, 332.308, 339.231, 346.154, 353.077, 360, 360, 364.286, 368.571, 372.857, 377.143, 381.429, 385.714, 390, 394.286, 398.571, 402.857, 407.143, 411.429, 415.714, 420, 424.286, 428.571, 432.857, 437.143, 441.429, 445.714, 450, 452.727, 455.455, 458.182, 460.909, 463.636, 466.364, 469.091, 471.818, 474.545, 477.273, 480, 482.727, 485.455, 488.182, 490.909, 493.636, 496.364, 499.091, 501.818, 504.545, 507.273, 510, 512.727, 515.455, 518.182, 520.909, 523.636, 526.364, 529.091, 531.818, 534.545, 537.273, 540, 541.667, 543.333, 545, 546.667, 548.333, 550, 551.667, 553.333, 555, 556.667, 558.333, 560, 561.667, 563.333, 565, 566.667, 568.333, 570, 571.667, 573.333, 575, 576.667, 578.333, 580, 581.667, 583.333, 585, 586.667, 588.333, 590, 591.667, 593.333, 595, 596.667, 598.333, 600, 601.667, 603.333, 605, 606.667, 608.333, 610, 611.667, 613.333, 615, 616.667, 618.333, 620, 621.667, 623.333, 625, 626.667, 628.333, 630, 631.034, 632.069, 633.103, 634.138, 635.172, 636.207, 637.241, 638.276, 639.31, 640.345, 641.379, 642.414, 643.448, 644.483, 645.517, 646.552, 647.586, 648.621, 649.655, 650.69, 651.724, 652.759, 653.793, 654.828, 655.862, 656.897, 657.931, 658.966, 660, 661.034, 662.069, 663.103, 664.138, 665.172, 666.207, 667.241, 668.276, 669.31, 670.345, 671.379, 672.414, 673.448, 674.483, 675.517, 676.552, 677.586, 678.621, 679.655, 680.69, 681.724, 682.759, 683.793, 684.828, 685.862, 686.897, 687.931, 688.966, 690, 691.034, 692.069, 693.103, 694.138, 695.172, 696.207, 697.241, 698.276, 699.31, 700.345, 701.379, 702.414, 703.448, 704.483, 705.517, 706.552, 707.586, 708.621, 709.655, 710.69, 711.724, 712.759, 713.793, 714.828, 715.862, 716.897, 717.931, 718.966, 720];
    
    actual_angles = [for(pt_angle = pts_angles) round_n(pt_angle[1], float_digits = 3)];

    assertEqualPoints(expected_pts, actual_pts);
    
    for(i = [0:len(expected_angles) - 1]) {
        assertEqualNum(
           expected_angles[i], 
           actual_angles[i]
        );
    }
}

test_golden_spiral();